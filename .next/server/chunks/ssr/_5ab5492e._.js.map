{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","../../../../src/app/tags/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nconst TAG_STORAGE_KEY = \"weekly-report-tags\";\r\nconst TASKS_KEY_PREFIX = \"weekly-report-tasks-\";\r\n\r\n// 初期タグ（localStorage に何もなかった時だけ使う）\r\nconst DEFAULT_TAGS = [\"開発\", \"学習\", \"就活\", \"事務\", \"生活\"];\r\n\r\nfunction safeParseTags(raw: string | null): string[] | null {\r\n  if (!raw) return null;\r\n  try {\r\n    const parsed = JSON.parse(raw);\r\n    if (!Array.isArray(parsed)) return null;\r\n\r\n    const cleaned = parsed\r\n      .filter((x) => typeof x === \"string\")\r\n      .map((x) => x.trim())\r\n      .filter((x) => x.length > 0);\r\n\r\n    // ✅ 空配列も「ユーザーが全部消した結果」として尊重する\r\n    return Array.from(new Set(cleaned));\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction loadTags(): string[] {\r\n  if (typeof window === \"undefined\") return DEFAULT_TAGS;\r\n\r\n  const raw = window.localStorage.getItem(TAG_STORAGE_KEY);\r\n  const parsed = safeParseTags(raw);\r\n\r\n  // ✅ 保存済みがあるならそれを使う（空配列もOK）\r\n  if (parsed !== null) return parsed;\r\n\r\n  // ✅ 初回だけ DEFAULT_TAGS を保存して初期化しておく\r\n  window.localStorage.setItem(TAG_STORAGE_KEY, JSON.stringify(DEFAULT_TAGS));\r\n  return DEFAULT_TAGS;\r\n}\r\n\r\nfunction saveTags(tags: string[]) {\r\n  if (typeof window === \"undefined\") return;\r\n  window.localStorage.setItem(TAG_STORAGE_KEY, JSON.stringify(tags));\r\n}\r\n\r\nfunction cleanupDeletedTagFromAllTasks(deletedTag: string) {\r\n  if (typeof window === \"undefined\") return;\r\n\r\n  for (let i = 0; i < window.localStorage.length; i++) {\r\n    const key = window.localStorage.key(i);\r\n    if (!key || !key.startsWith(TASKS_KEY_PREFIX)) continue;\r\n\r\n    const raw = window.localStorage.getItem(key);\r\n    if (!raw) continue;\r\n\r\n    try {\r\n      const parsed = JSON.parse(raw);\r\n      if (!Array.isArray(parsed)) continue;\r\n\r\n      const updated = parsed.map((t: any) => {\r\n        if (!t || typeof t !== \"object\") return t;\r\n        if (t.tag !== deletedTag) return t;\r\n        return { ...t, tag: null };\r\n      });\r\n\r\n      window.localStorage.setItem(key, JSON.stringify(updated));\r\n    } catch {\r\n      // 壊れてるデータがあっても止めない\r\n    }\r\n  }\r\n}\r\n\r\nexport default function TagsPage() {\r\n  const [tags, setTags] = useState<string[]>(DEFAULT_TAGS);\r\n  const [newTag, setNewTag] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    setTags(loadTags());\r\n  }, []);\r\n\r\n  const normalizedNewTag = useMemo(() => newTag.trim(), [newTag]);\r\n\r\n  const handleAdd = () => {\r\n    const t = normalizedNewTag;\r\n    if (!t) return;\r\n\r\n    // 重複防止（完全一致）\r\n    if (tags.includes(t)) {\r\n      setMessage(\"同じタグがすでにあります\");\r\n      setTimeout(() => setMessage(\"\"), 1500);\r\n      return;\r\n    }\r\n\r\n    const next = [...tags, t];\r\n    setTags(next);\r\n\r\n    // ✅ ここで即保存（重要）\r\n    saveTags(next);\r\n\r\n    setNewTag(\"\");\r\n    setMessage(\"タグを追加しました\");\r\n    setTimeout(() => setMessage(\"\"), 1500);\r\n  };\r\n\r\n  const handleDelete = (tag: string) => {\r\n    const ok = window.confirm(\r\n      `「${tag}」を削除します。\\nこのタグが付いたタスクは「未設定」になります。`\r\n    );\r\n    if (!ok) return;\r\n\r\n    const next = tags.filter((t) => t !== tag);\r\n    setTags(next);\r\n\r\n    // ✅ ここで即保存（重要）\r\n    saveTags(next);\r\n\r\n    // ✅ 既存タスクからもタグを外す\r\n    cleanupDeletedTagFromAllTasks(tag);\r\n\r\n    setMessage(\"タグを削除しました\");\r\n    setTimeout(() => setMessage(\"\"), 1500);\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-slate-50\">\r\n      <div className=\"mx-auto max-w-3xl py-6 px-4 md:px-8 space-y-6\">\r\n        <header className=\"space-y-2\">\r\n          <Link\r\n            href=\"/reports\"\r\n            className=\"inline-flex items-center text-[11px] md:text-xs text-slate-600 hover:text-slate-900\"\r\n          >\r\n            ← 週報一覧に戻る\r\n          </Link>\r\n          <h1 className=\"text-xl md:text-3xl font-bold\">タグ管理</h1>\r\n          <p className=\"text-xs md:text-sm text-slate-600\">\r\n            タグを追加・削除できます。削除したタグが付いたタスクは自動で「未設定」に置き換わります。\r\n          </p>\r\n        </header>\r\n\r\n        <section className=\"rounded-xl border bg-white shadow-sm p-4 md:p-5 space-y-3\">\r\n          <h2 className=\"text-base md:text-lg font-semibold\">タグを追加</h2>\r\n          <div className=\"flex flex-col md:flex-row gap-3\">\r\n            <input\r\n              className=\"flex-1 rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400 focus:border-slate-400\"\r\n              placeholder=\"例：研究 / バイト / 体調管理\"\r\n              value={newTag}\r\n              onChange={(e) => setNewTag(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  e.preventDefault();\r\n                  handleAdd();\r\n                }\r\n              }}\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleAdd}\r\n              className=\"w-full md:w-auto inline-flex justify-center items-center rounded-lg px-5 py-2.5 text-sm font-medium border border-slate-800 bg-slate-900 text-white hover:bg-slate-800 transition\"\r\n            >\r\n              ＋ 追加\r\n            </button>\r\n          </div>\r\n          {message && <p className=\"text-[11px] md:text-xs text-emerald-600\">{message}</p>}\r\n        </section>\r\n\r\n        <section className=\"rounded-xl border bg-white shadow-sm p-4 md:p-5 space-y-3\">\r\n          <h2 className=\"text-base md:text-lg font-semibold\">登録済みタグ</h2>\r\n\r\n          {tags.length === 0 ? (\r\n            <p className=\"text-sm text-slate-600\">タグがありません。</p>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {tags.map((tag) => (\r\n                <li key={tag} className=\"flex items-center justify-between rounded-lg border px-3 py-2\">\r\n                  <span className=\"text-sm text-slate-900\">{tag}</span>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => handleDelete(tag)}\r\n                    className=\"text-xs text-red-500 hover:text-red-600 hover:underline\"\r\n                  >\r\n                    削除\r\n                  </button>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </section>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":["module","exports","require","vendored","ReactServerDOMTurbopackClient"],"mappings":"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","ignoreList":[0]}