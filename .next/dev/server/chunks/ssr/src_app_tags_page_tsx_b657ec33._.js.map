{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hinat/projects/weekly-report-app/src/app/tags/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nconst TAG_STORAGE_KEY = \"weekly-report-tags\";\r\nconst TASKS_KEY_PREFIX = \"weekly-report-tasks-\";\r\n\r\n// 初期タグ（localStorage に何もなかった時だけ使う）\r\nconst DEFAULT_TAGS = [\"開発\", \"学習\", \"就活\", \"事務\", \"生活\"];\r\n\r\nfunction safeParseTags(raw: string | null): string[] | null {\r\n  if (!raw) return null;\r\n  try {\r\n    const parsed = JSON.parse(raw);\r\n    if (!Array.isArray(parsed)) return null;\r\n\r\n    const cleaned = parsed\r\n      .filter((x) => typeof x === \"string\")\r\n      .map((x) => x.trim())\r\n      .filter((x) => x.length > 0);\r\n\r\n    // ✅ 空配列も「ユーザーが全部消した結果」として尊重する\r\n    return Array.from(new Set(cleaned));\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction loadTags(): string[] {\r\n  if (typeof window === \"undefined\") return DEFAULT_TAGS;\r\n\r\n  const raw = window.localStorage.getItem(TAG_STORAGE_KEY);\r\n  const parsed = safeParseTags(raw);\r\n\r\n  // ✅ 保存済みがあるならそれを使う（空配列もOK）\r\n  if (parsed !== null) return parsed;\r\n\r\n  // ✅ 初回だけ DEFAULT_TAGS を保存して初期化しておく\r\n  window.localStorage.setItem(TAG_STORAGE_KEY, JSON.stringify(DEFAULT_TAGS));\r\n  return DEFAULT_TAGS;\r\n}\r\n\r\nfunction saveTags(tags: string[]) {\r\n  if (typeof window === \"undefined\") return;\r\n  window.localStorage.setItem(TAG_STORAGE_KEY, JSON.stringify(tags));\r\n}\r\n\r\nfunction cleanupDeletedTagFromAllTasks(deletedTag: string) {\r\n  if (typeof window === \"undefined\") return;\r\n\r\n  for (let i = 0; i < window.localStorage.length; i++) {\r\n    const key = window.localStorage.key(i);\r\n    if (!key || !key.startsWith(TASKS_KEY_PREFIX)) continue;\r\n\r\n    const raw = window.localStorage.getItem(key);\r\n    if (!raw) continue;\r\n\r\n    try {\r\n      const parsed = JSON.parse(raw);\r\n      if (!Array.isArray(parsed)) continue;\r\n\r\n      const updated = parsed.map((t: any) => {\r\n        if (!t || typeof t !== \"object\") return t;\r\n        if (t.tag !== deletedTag) return t;\r\n        return { ...t, tag: null };\r\n      });\r\n\r\n      window.localStorage.setItem(key, JSON.stringify(updated));\r\n    } catch {\r\n      // 壊れてるデータがあっても止めない\r\n    }\r\n  }\r\n}\r\n\r\nexport default function TagsPage() {\r\n  const [tags, setTags] = useState<string[]>(DEFAULT_TAGS);\r\n  const [newTag, setNewTag] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    setTags(loadTags());\r\n  }, []);\r\n\r\n  const normalizedNewTag = useMemo(() => newTag.trim(), [newTag]);\r\n\r\n  const handleAdd = () => {\r\n    const t = normalizedNewTag;\r\n    if (!t) return;\r\n\r\n    // 重複防止（完全一致）\r\n    if (tags.includes(t)) {\r\n      setMessage(\"同じタグがすでにあります\");\r\n      setTimeout(() => setMessage(\"\"), 1500);\r\n      return;\r\n    }\r\n\r\n    const next = [...tags, t];\r\n    setTags(next);\r\n\r\n    // ✅ ここで即保存（重要）\r\n    saveTags(next);\r\n\r\n    setNewTag(\"\");\r\n    setMessage(\"タグを追加しました\");\r\n    setTimeout(() => setMessage(\"\"), 1500);\r\n  };\r\n\r\n  const handleDelete = (tag: string) => {\r\n    const ok = window.confirm(\r\n      `「${tag}」を削除します。\\nこのタグが付いたタスクは「未設定」になります。`\r\n    );\r\n    if (!ok) return;\r\n\r\n    const next = tags.filter((t) => t !== tag);\r\n    setTags(next);\r\n\r\n    // ✅ ここで即保存（重要）\r\n    saveTags(next);\r\n\r\n    // ✅ 既存タスクからもタグを外す\r\n    cleanupDeletedTagFromAllTasks(tag);\r\n\r\n    setMessage(\"タグを削除しました\");\r\n    setTimeout(() => setMessage(\"\"), 1500);\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-slate-50\">\r\n      <div className=\"mx-auto max-w-3xl py-6 px-4 md:px-8 space-y-6\">\r\n        <header className=\"space-y-2\">\r\n          <Link\r\n            href=\"/reports\"\r\n            className=\"inline-flex items-center text-[11px] md:text-xs text-slate-600 hover:text-slate-900\"\r\n          >\r\n            ← 週報一覧に戻る\r\n          </Link>\r\n          <h1 className=\"text-xl md:text-3xl font-bold\">タグ管理</h1>\r\n          <p className=\"text-xs md:text-sm text-slate-600\">\r\n            タグを追加・削除できます。削除したタグが付いたタスクは自動で「未設定」に置き換わります。\r\n          </p>\r\n        </header>\r\n\r\n        <section className=\"rounded-xl border bg-white shadow-sm p-4 md:p-5 space-y-3\">\r\n          <h2 className=\"text-base md:text-lg font-semibold\">タグを追加</h2>\r\n          <div className=\"flex flex-col md:flex-row gap-3\">\r\n            <input\r\n              className=\"flex-1 rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400 focus:border-slate-400\"\r\n              placeholder=\"例：研究 / バイト / 体調管理\"\r\n              value={newTag}\r\n              onChange={(e) => setNewTag(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  e.preventDefault();\r\n                  handleAdd();\r\n                }\r\n              }}\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleAdd}\r\n              className=\"w-full md:w-auto inline-flex justify-center items-center rounded-lg px-5 py-2.5 text-sm font-medium border border-slate-800 bg-slate-900 text-white hover:bg-slate-800 transition\"\r\n            >\r\n              ＋ 追加\r\n            </button>\r\n          </div>\r\n          {message && <p className=\"text-[11px] md:text-xs text-emerald-600\">{message}</p>}\r\n        </section>\r\n\r\n        <section className=\"rounded-xl border bg-white shadow-sm p-4 md:p-5 space-y-3\">\r\n          <h2 className=\"text-base md:text-lg font-semibold\">登録済みタグ</h2>\r\n\r\n          {tags.length === 0 ? (\r\n            <p className=\"text-sm text-slate-600\">タグがありません。</p>\r\n          ) : (\r\n            <ul className=\"space-y-2\">\r\n              {tags.map((tag) => (\r\n                <li key={tag} className=\"flex items-center justify-between rounded-lg border px-3 py-2\">\r\n                  <span className=\"text-sm text-slate-900\">{tag}</span>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => handleDelete(tag)}\r\n                    className=\"text-xs text-red-500 hover:text-red-600 hover:underline\"\r\n                  >\r\n                    削除\r\n                  </button>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </section>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}