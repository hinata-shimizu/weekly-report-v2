{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hinat/projects/weekly-report-app/src/app/reports/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\ntype Report = {\r\n  id: string;\r\n  title: string;       // 「M/D～M/Dの週報」\r\n  description: string; // 説明\r\n  createdAt: string;   // ISO文字列\r\n  weekStart: string;   // その週の開始日（ISO）\r\n  weekEnd: string;     // その週の終了日（ISO）\r\n};\r\n\r\nconst STORAGE_KEY = \"weekly-report-list\";\r\n\r\n/** 週の開始・終了（ここでは「月曜はじまり、日曜おわり」にしています） */\r\nfunction getWeekRange(date: Date): { start: Date; end: Date } {\r\n  const d = new Date(date);\r\n  d.setHours(0, 0, 0, 0);\r\n\r\n  const day = d.getDay(); // 0:日, 1:月, ... 6:土\r\n  const diffFromMonday = (day + 6) % 7; // 月曜を0にする調整\r\n  const start = new Date(d);\r\n  start.setDate(d.getDate() - diffFromMonday);\r\n  start.setHours(0, 0, 0, 0);\r\n\r\n  const end = new Date(start);\r\n  end.setDate(start.getDate() + 6);\r\n  end.setHours(23, 59, 59, 999);\r\n\r\n  return { start, end };\r\n}\r\n\r\n/** タイトル用：「M/D～M/Dの週報」 */\r\nfunction formatWeekRangeTitle(startIso: string, endIso: string): string {\r\n  const s = new Date(startIso);\r\n  const e = new Date(endIso);\r\n  if (Number.isNaN(s.getTime()) || Number.isNaN(e.getTime())) {\r\n    return \"週報\";\r\n  }\r\n  const sStr = s.toLocaleDateString(\"ja-JP\", {\r\n    month: \"numeric\",\r\n    day: \"numeric\",\r\n  });\r\n  const eStr = e.toLocaleDateString(\"ja-JP\", {\r\n    month: \"numeric\",\r\n    day: \"numeric\",\r\n  });\r\n  return `${sStr}～${eStr}の週報`;\r\n}\r\n\r\n/** 作成日の表示用（例: 2025/12/13） */\r\nfunction formatDate(iso: string): string {\r\n  const d = new Date(iso);\r\n  if (Number.isNaN(d.getTime())) return \"\";\r\n  return d.toLocaleDateString(\"ja-JP\", {\r\n    year: \"numeric\",\r\n    month: \"2-digit\",\r\n    day: \"2-digit\",\r\n  });\r\n}\r\n\r\n/** 一覧を「新しい順」に並べ替える（createdAt → id の順） */\r\nfunction sortReportsDesc(reports: Report[]): Report[] {\r\n  return [...reports].sort((a, b) => {\r\n    const ta = new Date(a.createdAt).getTime();\r\n    const tb = new Date(b.createdAt).getTime();\r\n    if (!Number.isNaN(ta) && !Number.isNaN(tb) && ta !== tb) {\r\n      return tb - ta; // 新しいcreatedAtが上\r\n    }\r\n    const na = Number(a.id);\r\n    const nb = Number(b.id);\r\n    if (!Number.isNaN(na) && !Number.isNaN(nb)) {\r\n      return nb - na;\r\n    }\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport default function ReportsPage() {\r\n  const [reports, setReports] = useState<Report[]>([]);\r\n  const [loaded, setLoaded] = useState(false);\r\n\r\n  // 初回読み込み時：localStorage から一覧を読む\r\n  useEffect(() => {\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    const raw = window.localStorage.getItem(STORAGE_KEY);\r\n\r\n    if (!raw) {\r\n      // 初期サンプル（全部「今週」の週報として扱う）\r\n      const now = new Date();\r\n      const { start, end } = getWeekRange(now);\r\n      const weekStartIso = start.toISOString();\r\n      const weekEndIso = end.toISOString();\r\n      const title = formatWeekRangeTitle(weekStartIso, weekEndIso);\r\n      const createdAt = now.toISOString();\r\n\r\n      const initial: Report[] = [\r\n        {\r\n          id: \"1\",\r\n          title,\r\n          description: \"この週に取り組んだタスクや学びを整理します。（サンプル）\",\r\n          createdAt,\r\n          weekStart: weekStartIso,\r\n          weekEnd: weekEndIso,\r\n        },\r\n        {\r\n          id: \"2\",\r\n          title,\r\n          description: \"引き続き、今週のアウトプットを記録します。（サンプル）\",\r\n          createdAt,\r\n          weekStart: weekStartIso,\r\n          weekEnd: weekEndIso,\r\n        },\r\n        {\r\n          id: \"3\",\r\n          title,\r\n          description: \"より具体的な成果や反省点を書き出してみましょう。（サンプル）\",\r\n          createdAt,\r\n          weekStart: weekStartIso,\r\n          weekEnd: weekEndIso,\r\n        },\r\n      ];\r\n      setReports(sortReportsDesc(initial));\r\n      setLoaded(true);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const parsed = JSON.parse(raw) as any[];\r\n      if (Array.isArray(parsed)) {\r\n        const normalized: Report[] = parsed.map((r, index) => {\r\n          const id = String(r.id ?? index + 1);\r\n\r\n          const createdAt =\r\n            typeof r.createdAt === \"string\" && r.createdAt\r\n              ? r.createdAt\r\n              : new Date().toISOString();\r\n          const createdDate = new Date(createdAt);\r\n          const baseDate = Number.isNaN(createdDate.getTime())\r\n            ? new Date()\r\n            : createdDate;\r\n\r\n          let weekStartIso: string;\r\n          let weekEndIso: string;\r\n\r\n          if (typeof r.weekStart === \"string\" && typeof r.weekEnd === \"string\") {\r\n            weekStartIso = r.weekStart;\r\n            weekEndIso = r.weekEnd;\r\n          } else {\r\n            const { start, end } = getWeekRange(baseDate);\r\n            weekStartIso = start.toISOString();\r\n            weekEndIso = end.toISOString();\r\n          }\r\n\r\n          const title = formatWeekRangeTitle(weekStartIso, weekEndIso);\r\n\r\n          const description =\r\n            typeof r.description === \"string\" && r.description.trim() !== \"\"\r\n              ? r.description\r\n              : \"この週のタスクや振り返りを記録します。\";\r\n\r\n          return {\r\n            id,\r\n            title,\r\n            description,\r\n            createdAt,\r\n            weekStart: weekStartIso,\r\n            weekEnd: weekEndIso,\r\n          };\r\n        });\r\n\r\n        setReports(sortReportsDesc(normalized));\r\n      } else {\r\n        setReports([]);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"failed to parse reports from localStorage\", e);\r\n      setReports([]);\r\n    }\r\n\r\n    setLoaded(true);\r\n  }, []);\r\n\r\n  // 一覧が変わるたびに保存\r\n  useEffect(() => {\r\n    if (!loaded) return;\r\n    if (typeof window === \"undefined\") return;\r\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(reports));\r\n  }, [reports, loaded]);\r\n\r\n  // 新しい週を追加\r\n  const handleAddReport = () => {\r\n    setReports((prev) => {\r\n      const numericIds = prev\r\n        .map((r) => Number(r.id))\r\n        .filter((n) => !Number.isNaN(n));\r\n      const nextIdNum =\r\n        numericIds.length > 0 ? Math.max(...numericIds) + 1 : 1;\r\n      const nextId = String(nextIdNum);\r\n\r\n      const now = new Date();\r\n      const { start, end } = getWeekRange(now);\r\n      const weekStartIso = start.toISOString();\r\n      const weekEndIso = end.toISOString();\r\n\r\n      const newReport: Report = {\r\n        id: nextId,\r\n        title: formatWeekRangeTitle(weekStartIso, weekEndIso),\r\n        description: \"新しく作成した週のタスクや振り返りを記録できます。\",\r\n        createdAt: now.toISOString(),\r\n        weekStart: weekStartIso,\r\n        weekEnd: weekEndIso,\r\n      };\r\n\r\n      const next = [newReport, ...prev];\r\n      return sortReportsDesc(next);\r\n    });\r\n  };\r\n\r\n  // 週報削除（確認ダイアログ付き）\r\n  const handleDelete = (reportId: string) => {\r\n    if (typeof window !== \"undefined\") {\r\n      const ok = window.confirm(\r\n        \"本当にこの週報を削除してよろしいですか？\\n（この週報に紐づくタスクもすべて削除されます）\"\r\n      );\r\n      if (!ok) return;\r\n\r\n      // その週報のタスクも削除\r\n      window.localStorage.removeItem(`weekly-report-tasks-${reportId}`);\r\n    }\r\n\r\n    setReports((prev) => prev.filter((r) => r.id !== reportId));\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-slate-50\">\r\n      <div className=\"mx-auto max-w-6xl py-6 px-4 md:px-8 space-y-6\">\r\n        {/* ヘッダー */}\r\n        <header className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\r\n          <div className=\"space-y-1.5\">\r\n            <h1 className=\"text-xl md:text-3xl font-bold\">週報一覧</h1>\r\n            <p className=\"text-xs md:text-sm text-slate-600 max-w-2xl\">\r\n              週ごとのタスクや振り返りをまとめたページです。\r\n              各行をクリックすると、その週の詳細なタスク管理画面に移動します。\r\n            </p>\r\n            {!loaded && (\r\n              <p className=\"text-[11px] text-slate-500\">読み込み中...</p>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            <p className=\"text-[11px] md:text-xs text-slate-500\">\r\n              週報の数:{\" \"}\r\n              <span className=\"font-semibold text-slate-800\">\r\n                {reports.length}\r\n              </span>\r\n            </p>\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleAddReport}\r\n              className=\"inline-flex items-center gap-1 rounded-lg border border-slate-800 bg-slate-900 px-4 py-2 text-xs md:text-sm font-medium text-white hover:bg-slate-800 transition\"\r\n            >\r\n              ＋ 新しい週を追加\r\n            </button>\r\n          </div>\r\n        </header>\r\n\r\n        {/* 週報一覧（1週1行のリスト表示） */}\r\n        {reports.length === 0 ? (\r\n          <div className=\"rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center space-y-2\">\r\n            <p className=\"text-sm text-slate-600\">週報がまだありません。</p>\r\n            <p className=\"text-[11px] md:text-xs text-slate-500\">\r\n              「新しい週を追加」ボタンから、最初の週報を作成してみてください。\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <section className=\"rounded-xl border bg-white shadow-sm\">\r\n            <ul className=\"divide-y divide-slate-100\">\r\n              {reports.map((report) => (\r\n                <li key={report.id}>\r\n                  <Link\r\n                    href={`/reports/${report.id}`}\r\n                    className=\"group flex items-center gap-3 px-4 py-2.5 md:px-5 md:py-3 hover:bg-slate-50 transition\"\r\n                  >\r\n                    {/* 左：タイトル＋説明 */}\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"text-sm md:text-base font-medium text-slate-900 group-hover:text-slate-950 truncate\">\r\n                        {report.title}\r\n                      </p>\r\n                      <p className=\"text-[11px] md:text-xs text-slate-600 line-clamp-1\">\r\n                        {report.description}\r\n                      </p>\r\n                    </div>\r\n\r\n                    {/* 右：作成日＋削除ボタン＋矢印 */}\r\n                    <div className=\"flex items-center gap-3 text-[10px] md:text-[11px] text-slate-500\">\r\n                      <span>\r\n                        作成日:{\" \"}\r\n                        <span className=\"font-medium\">\r\n                          {formatDate(report.createdAt)}\r\n                        </span>\r\n                      </span>\r\n\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          handleDelete(report.id);\r\n                        }}\r\n                        className=\"text-[10px] md:text-[11px] text-red-500 hover:text-red-600 hover:underline\"\r\n                      >\r\n                        削除\r\n                      </button>\r\n\r\n                      <span className=\"inline-flex items-center gap-1 text-slate-600 group-hover:text-slate-900\">\r\n                        週報を開く\r\n                        <span aria-hidden>→</span>\r\n                      </span>\r\n                    </div>\r\n                  </Link>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </section>\r\n        )}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}